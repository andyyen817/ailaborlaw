# AIåŠ³æ³•é€šèŠå¤©æ¨¡å—APIæ–‡æ¡£ v1.0

## ğŸ“– æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸ºå‰ç«¯å¼€å‘æä¾›å®Œæ•´çš„èŠå¤©æ¨¡å—APIæ¥å£è§„èŒƒã€‚å‰ç«¯å¯ä»¥åŸºäºæ­¤æ–‡æ¡£è¿›è¡Œå¼€å‘ï¼Œä½¿ç”¨Mockæ•°æ®è¿›è¡ŒUIè°ƒè¯•ï¼Œåç«¯å®Œæˆåæ— ç¼å¯¹æ¥ã€‚

**åŸºç¡€ä¿¡æ¯ï¼š**
- åŸºç¡€URL: `https://wrrfvodsaofk.sealosgzg.site/api/v1/chat`
- è®¤è¯æ–¹å¼: JWT Bearer Token (å·²é›†æˆç°æœ‰è®¤è¯ç³»ç»Ÿ)
- æ•°æ®æ ¼å¼: JSON
- å­—ç¬¦ç¼–ç : UTF-8

---

## ğŸ” è®¤è¯è¯´æ˜

æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Tokenï¼š
```javascript
Authorization: Bearer <token>
```

**ç°æœ‰è®¤è¯ç³»ç»Ÿå·²é›†æˆï¼š**
- ç”¨æˆ·ç™»å½•åè·å–token
- hasRemainingQueriesä¸­é—´ä»¶è‡ªåŠ¨æ£€æŸ¥å’¨è¯¢æ¬¡æ•°
- å‘é€æ¶ˆæ¯æ—¶è‡ªåŠ¨æ‰£å‡æ¬¡æ•°

---

## ğŸ“‹ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ç”¨æˆ·èŠå¤©æµç¨‹
1. **åˆ›å»ºä¼šè¯** â†’ 2. **å‘é€æ¶ˆæ¯** â†’ 3. **æ¥æ”¶AIå›å¤** â†’ 4. **æŸ¥çœ‹å†å²** â†’ 5. **æä¾›åé¦ˆ**

### ç®¡ç†å‘˜ç›‘æ§æµç¨‹
1. **æŸ¥çœ‹æ‰€æœ‰ä¼šè¯** â†’ 2. **ç›‘æ§æ¶ˆæ¯è´¨é‡** â†’ 3. **ç»Ÿè®¡åˆ†æ** â†’ 4. **å¯¼å‡ºæ•°æ®**

---

## ğŸš€ APIæ¥å£è¯¦ç»†è§„èŒƒ

### 1. ä¼šè¯ç®¡ç† API

#### 1.1 åˆ›å»ºæ–°ä¼šè¯
```
POST /api/v1/chat/sessions
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "title": "å…³äºåŠ ç­è´¹çš„é—®é¢˜" // å¯é€‰ï¼Œä¸ä¼ åˆ™è‡ªåŠ¨ç”Ÿæˆ
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ä¼šè¯åˆ›å»ºæˆåŠŸ",
  "data": {
    "sessionId": "sess_1732373814567_k8m2n9p1q",
    "title": "å…³äºåŠ ç­è´¹çš„é—®é¢˜",
    "status": "active",
    "messageCount": 0,
    "createdAt": "2024-05-24T10:30:00.000Z",
    "lastMessageAt": "2024-05-24T10:30:00.000Z"
  }
}
```

#### 1.2 è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
```
GET /api/v1/chat/sessions?page=1&limit=20&search=åŠ ç­
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç (é»˜è®¤1)
- `limit`: æ¯é¡µæ•°é‡(é»˜è®¤20ï¼Œæœ€å¤§50)
- `search`: æœç´¢å…³é”®è¯(å¯é€‰)

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "sessions": [
      {
        "sessionId": "sess_1732373814567_k8m2n9p1q",
        "title": "å…³äºåŠ ç­è´¹çš„é—®é¢˜",
        "status": "active",
        "messageCount": 5,
        "lastMessageAt": "2024-05-24T11:45:00.000Z",
        "createdAt": "2024-05-24T10:30:00.000Z",
        "duration": 4500 // ç§’
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalSessions": 50,
      "hasNextPage": true,
      "hasPrevPage": false
    }
  }
}
```

#### 1.3 è·å–ä¼šè¯è¯¦æƒ…
```
GET /api/v1/chat/sessions/{sessionId}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "session": {
      "sessionId": "sess_1732373814567_k8m2n9p1q",
      "title": "å…³äºåŠ ç­è´¹çš„é—®é¢˜",
      "status": "active",
      "messageCount": 5,
      "createdAt": "2024-05-24T10:30:00.000Z",
      "lastMessageAt": "2024-05-24T11:45:00.000Z",
      "duration": 4500
    },
    "messages": [
      {
        "messageId": "msg_1732373825123_a1b2c3d4e",
        "role": "user",
        "content": "è¯·é—®åŠ ç­è´¹çš„è®¡ç®—æ–¹å¼ï¼Ÿ",
        "status": "sent",
        "createdAt": "2024-05-24T10:30:15.000Z"
      },
      {
        "messageId": "msg_1732373835456_f5g6h7i8j",
        "role": "ai",
        "content": "æ ¹æ®åŠ³åŠ¨åŸºå‡†æ³•ç¬¬24æ¡è§„å®šï¼Œé›‡ä¸»å»¶é•¿åŠ³å·¥å·¥ä½œæ—¶é—´è€…ï¼Œå…¶å»¶é•¿å·¥ä½œæ—¶é—´ä¹‹å·¥èµ„ï¼Œä¾ä¸‹åˆ—æ ‡å‡†åŠ ç»™...",
        "status": "sent",
        "processingTime": 2340,
        "references": [
          {
            "law": "åŠ³åŠ¨åŸºå‡†æ³•",
            "article": "ç¬¬24æ¡",
            "content": "é›‡ä¸»å»¶é•¿åŠ³å·¥å·¥ä½œæ—¶é—´è€…ï¼Œå…¶å»¶é•¿å·¥ä½œæ—¶é—´ä¹‹å·¥èµ„ï¼Œä¾ä¸‹åˆ—æ ‡å‡†åŠ ç»™ï¼šä¸€ã€å»¶é•¿å·¥ä½œæ—¶é—´åœ¨äºŒå°æ—¶ä»¥å†…è€…ï¼ŒæŒ‰å¹³æ—¥æ¯å°æ—¶å·¥èµ„é¢åŠ ç»™ä¸‰åˆ†ä¹‹ä¸€ä»¥ä¸Šã€‚",
            "url": "https://law.moj.gov.tw/LawClass/LawAll.aspx?pcode=N0030001"
          }
        ],
        "feedback": null,
        "createdAt": "2024-05-24T10:30:18.340Z"
      }
    ]
  }
}
```

#### 1.4 æ›´æ–°ä¼šè¯æ ‡é¢˜
```
PUT /api/v1/chat/sessions/{sessionId}
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "title": "æ–°çš„ä¼šè¯æ ‡é¢˜"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ä¼šè¯æ ‡é¢˜æ›´æ–°æˆåŠŸ",
  "data": {
    "sessionId": "sess_1732373814567_k8m2n9p1q",
    "title": "æ–°çš„ä¼šè¯æ ‡é¢˜"
  }
}
```

#### 1.5 åˆ é™¤ä¼šè¯
```
DELETE /api/v1/chat/sessions/{sessionId}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ä¼šè¯å·²åˆ é™¤",
  "data": {
    "deletedSessionId": "sess_1732373814567_k8m2n9p1q",
    "deletedMessages": 5
  }
}
```

### 2. æ¶ˆæ¯ç®¡ç† API

#### 2.1 å‘é€æ¶ˆæ¯å¹¶è·å–AIå›å¤ â­ æ ¸å¿ƒåŠŸèƒ½
```
POST /api/v1/chat/sessions/{sessionId}/messages
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "content": "è¯·é—®åŠ ç­è´¹çš„è®¡ç®—æ–¹å¼ï¼Ÿ",
  "messageType": "question" // question, follow-up, clarification
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "userMessage": {
      "messageId": "msg_1732373825123_a1b2c3d4e",
      "role": "user",
      "content": "è¯·é—®åŠ ç­è´¹çš„è®¡ç®—æ–¹å¼ï¼Ÿ",
      "status": "sent",
      "createdAt": "2024-05-24T10:30:15.000Z"
    },
    "aiResponse": {
      "messageId": "msg_1732373835456_f5g6h7i8j",
      "role": "ai",
      "content": "æ ¹æ®åŠ³åŠ¨åŸºå‡†æ³•ç¬¬24æ¡è§„å®šï¼Œé›‡ä¸»å»¶é•¿åŠ³å·¥å·¥ä½œæ—¶é—´è€…ï¼Œå…¶å»¶é•¿å·¥ä½œæ—¶é—´ä¹‹å·¥èµ„ï¼Œä¾ä¸‹åˆ—æ ‡å‡†åŠ ç»™ï¼š\n\nä¸€ã€å»¶é•¿å·¥ä½œæ—¶é—´åœ¨äºŒå°æ—¶ä»¥å†…è€…ï¼ŒæŒ‰å¹³æ—¥æ¯å°æ—¶å·¥èµ„é¢åŠ ç»™ä¸‰åˆ†ä¹‹ä¸€ä»¥ä¸Šã€‚\näºŒã€å†å»¶é•¿å·¥ä½œæ—¶é—´åœ¨äºŒå°æ—¶ä»¥å†…è€…ï¼ŒæŒ‰å¹³æ—¥æ¯å°æ—¶å·¥èµ„é¢åŠ ç»™ä¸‰åˆ†ä¹‹äºŒä»¥ä¸Šã€‚\nä¸‰ã€ä¾ç¬¬ä¸‰åäºŒæ¡ç¬¬å››é¡¹è§„å®šï¼Œå»¶é•¿å·¥ä½œæ—¶é—´è€…ï¼ŒæŒ‰å¹³æ—¥æ¯å°æ—¶å·¥èµ„é¢åŠ å€å‘ç»™ã€‚",
      "status": "sent",
      "processingTime": 2340,
      "references": [
        {
          "law": "åŠ³åŠ¨åŸºå‡†æ³•",
          "article": "ç¬¬24æ¡",
          "content": "é›‡ä¸»å»¶é•¿åŠ³å·¥å·¥ä½œæ—¶é—´è€…ï¼Œå…¶å»¶é•¿å·¥ä½œæ—¶é—´ä¹‹å·¥èµ„ï¼Œä¾ä¸‹åˆ—æ ‡å‡†åŠ ç»™ï¼šä¸€ã€å»¶é•¿å·¥ä½œæ—¶é—´åœ¨äºŒå°æ—¶ä»¥å†…è€…ï¼ŒæŒ‰å¹³æ—¥æ¯å°æ—¶å·¥èµ„é¢åŠ ç»™ä¸‰åˆ†ä¹‹ä¸€ä»¥ä¸Šã€‚",
          "url": "https://law.moj.gov.tw/LawClass/LawAll.aspx?pcode=N0030001"
        }
      ],
      "createdAt": "2024-05-24T10:30:18.340Z"
    },
    "remainingQueries": 9, // ç”¨æˆ·å‰©ä½™å’¨è¯¢æ¬¡æ•°
    "sessionUpdated": {
      "messageCount": 2,
      "lastMessageAt": "2024-05-24T10:30:18.340Z"
    }
  }
}
```

#### 2.2 è·å–ä¼šè¯æ¶ˆæ¯åˆ—è¡¨
```
GET /api/v1/chat/sessions/{sessionId}/messages?page=1&limit=50&before=2024-05-24T10:30:00.000Z
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page`: é¡µç (é»˜è®¤1)
- `limit`: æ¯é¡µæ•°é‡(é»˜è®¤50)
- `before`: è·å–æŒ‡å®šæ—¶é—´ä¹‹å‰çš„æ¶ˆæ¯(å¯é€‰ï¼Œç”¨äºæ— é™æ»šåŠ¨)

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "messages": [
      // æ¶ˆæ¯æ•°ç»„ï¼ŒæŒ‰æ—¶é—´æ­£åºæ’åˆ—
    ],
    "pagination": {
      "currentPage": 1,
      "totalMessages": 10,
      "hasMore": false
    }
  }
}
```

#### 2.3 ä¸ºAIå›å¤æä¾›åé¦ˆ
```
POST /api/v1/chat/sessions/{sessionId}/messages/{messageId}/feedback
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "feedback": "helpful" // helpful, not_helpful
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "åé¦ˆæäº¤æˆåŠŸ",
  "data": {
    "messageId": "msg_1732373835456_f5g6h7i8j",
    "feedback": "helpful",
    "feedbackAt": "2024-05-24T10:35:00.000Z"
  }
}
```

### 3. ç®¡ç†åå° API

#### 3.1 è·å–æ‰€æœ‰ç”¨æˆ·ä¼šè¯ (ç®¡ç†å‘˜æƒé™)
```
GET /api/v1/chat/admin/sessions?page=1&limit=20&status=active&userId=ç”¨æˆ·ID&search=å…³é”®è¯
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "sessions": [
      {
        "sessionId": "sess_1732373814567_k8m2n9p1q",
        "userId": "60d5f483e8b0d41234567890",
        "userName": "å¼ ä¸‰",
        "userEmail": "zhangsan@example.com",
        "title": "å…³äºåŠ ç­è´¹çš„é—®é¢˜",
        "messageCount": 5,
        "status": "active",
        "createdAt": "2024-05-24T10:30:00.000Z",
        "lastMessageAt": "2024-05-24T11:45:00.000Z"
      }
    ],
    "stats": {
      "totalSessions": 156,
      "activeSessions": 89,
      "completedSessions": 67,
      "avgMessagesPerSession": 4.2
    }
  }
}
```

#### 3.2 è·å–èŠå¤©ç»Ÿè®¡æ•°æ® (ç®¡ç†å‘˜æƒé™)
```
GET /api/v1/chat/admin/stats?startDate=2024-05-01&endDate=2024-05-24
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalSessions": 156,
      "totalMessages": 658,
      "totalUsers": 89,
      "avgSessionDuration": 320, // ç§’
      "avgResponseTime": 2.1 // ç§’
    },
    "dailyStats": [
      {
        "date": "2024-05-24",
        "sessions": 12,
        "messages": 48,
        "avgResponseTime": 2.3
      }
    ],
    "feedbackStats": {
      "helpful": 142,
      "not_helpful": 28,
      "satisfaction": 83.5 // ç™¾åˆ†æ¯”
    },
    "topCategories": [
      { "category": "åŠ ç­è´¹", "count": 34 },
      { "category": "ä¼‘å‡", "count": 28 }
    ]
  }
}
```

#### 3.3 å¯¼å‡ºèŠå¤©è®°å½• (ç®¡ç†å‘˜æƒé™)
```
POST /api/v1/chat/admin/export
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "startDate": "2024-05-01",
  "endDate": "2024-05-24",
  "format": "excel", // excel, csv
  "includeUserInfo": true,
  "sessionIds": ["sess_123", "sess_456"] // å¯é€‰ï¼Œå¯¼å‡ºç‰¹å®šä¼šè¯
}
```

---

## ğŸš¨ é”™è¯¯ç å®šä¹‰

### é€šç”¨é”™è¯¯ç 
| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------------|------|----------|
| AUTH_001 | 401 | æœªè®¤è¯ | é‡æ–°ç™»å½•è·å–token |
| AUTH_002 | 403 | æƒé™ä¸è¶³ | æ£€æŸ¥ç”¨æˆ·æƒé™ |
| QUOTA_001 | 429 | å’¨è¯¢æ¬¡æ•°ä¸è¶³ | å¼•å¯¼ç”¨æˆ·è´­ä¹°å¥—é¤ |

### èŠå¤©æ¨¡å—é”™è¯¯ç 
| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------------|------|----------|
| CHAT_001 | 404 | ä¼šè¯ä¸å­˜åœ¨ | æ£€æŸ¥sessionIdæ˜¯å¦æ­£ç¡® |
| CHAT_002 | 403 | æ— æƒè®¿é—®æ­¤ä¼šè¯ | éªŒè¯ä¼šè¯æ‰€æœ‰æƒ |
| CHAT_003 | 400 | æ¶ˆæ¯å†…å®¹ä¸ºç©ºæˆ–è¿‡é•¿ | æ£€æŸ¥contentå­—æ®µ |
| CHAT_004 | 500 | AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ | æ˜¾ç¤ºé™çº§æç¤ºï¼Œå»ºè®®ç¨åé‡è¯• |
| CHAT_005 | 404 | æ¶ˆæ¯ä¸å­˜åœ¨ | æ£€æŸ¥messageIdæ˜¯å¦æ­£ç¡® |
| CHAT_006 | 500 | åé¦ˆæäº¤å¤±è´¥ | é‡è¯•æˆ–è”ç³»å®¢æœ |

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "success": false,
  "error": {
    "code": "CHAT_001",
    "message": "ä¼šè¯ä¸å­˜åœ¨",
    "details": "Session with ID sess_123 not found"
  }
}
```

---

## ğŸ’¡ å‰ç«¯å¼€å‘å»ºè®®

### 1. çŠ¶æ€ç®¡ç†
```javascript
// å»ºè®®çš„çŠ¶æ€ç»“æ„
const chatState = {
  currentSession: null,
  sessions: [],
  messages: {},
  loading: {
    sessions: false,
    messages: false,
    sending: false
  },
  pagination: {
    sessions: { page: 1, hasMore: true },
    messages: { hasMore: false }
  }
}
```

### 2. å®æ—¶ä½“éªŒä¼˜åŒ–
```javascript
// æ¶ˆæ¯å‘é€æµç¨‹
1. ç«‹å³åœ¨UIä¸­æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯ (status: 'sending')
2. è°ƒç”¨APIå‘é€æ¶ˆæ¯
3. æ˜¾ç¤º"AIæ­£åœ¨æ€è€ƒ..."åŠ è½½çŠ¶æ€
4. æ¥æ”¶AIå›å¤åæ›´æ–°UI
5. å¤„ç†é”™è¯¯æƒ…å†µå¹¶æä¾›é‡è¯•é€‰é¡¹
```

### 3. Mockæ•°æ®ç¤ºä¾‹
```javascript
// å¼€å‘æœŸé—´å¯ä»¥ä½¿ç”¨çš„Mockæ•°æ®
const mockSessions = [
  {
    sessionId: "sess_mock_001",
    title: "å…³äºåŠ ç­è´¹çš„é—®é¢˜",
    messageCount: 3,
    lastMessageAt: new Date().toISOString(),
    status: "active"
  }
];
```

### 4. å…³é”®äº¤äº’è®¾è®¡
- **åˆ›å»ºä¼šè¯**ï¼šç‚¹å‡»"æ–°å¯¹è¯"æŒ‰é’®
- **å‘é€æ¶ˆæ¯**ï¼šEnterå‘é€ï¼ŒShift+Enteræ¢è¡Œ
- **æ¶ˆæ¯åé¦ˆ**ï¼šAIå›å¤ä¸‹æ–¹æ˜¾ç¤ºğŸ‘ğŸ‘æŒ‰é’®
- **ä¼šè¯åˆ‡æ¢**ï¼šä¾§è¾¹æ ä¼šè¯åˆ—è¡¨
- **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºé‡è¯•æŒ‰é’®

---

## ğŸ”„ å¼€å‘å’Œæµ‹è¯•è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€åŠŸèƒ½ (ç¬¬1-2å¤©)
- [ ] ä¼šè¯åˆ›å»ºå’Œåˆ—è¡¨
- [ ] æ¶ˆæ¯å‘é€å’Œæ˜¾ç¤º
- [ ] AIå›å¤å±•ç¤º

### é˜¶æ®µ2ï¼šå®Œæ•´åŠŸèƒ½ (ç¬¬3å¤©)
- [ ] æ¶ˆæ¯åé¦ˆ
- [ ] ä¼šè¯ç®¡ç†ï¼ˆåˆ é™¤ã€é‡å‘½åï¼‰
- [ ] é”™è¯¯å¤„ç†

### é˜¶æ®µ3ï¼šç®¡ç†åå° (ç¬¬4å¤©)
- [ ] ç®¡ç†å‘˜ç›‘æ§ç•Œé¢
- [ ] ç»Ÿè®¡æ•°æ®å±•ç¤º
- [ ] æ•°æ®å¯¼å‡º

**å‰ç«¯å¯ä»¥ç«‹å³å¼€å§‹å¼€å‘ï¼Œä½¿ç”¨Mockæ•°æ®æµ‹è¯•UIï¼Œæˆ‘ä»¬å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±ç«‹å³æä¾›çœŸå®APIè¿›è¡Œè”è°ƒã€‚**

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ä»»ä½•æ¥å£ç–‘é—®æˆ–éœ€è¦è°ƒæ•´ï¼Œè¯·éšæ—¶æ²Ÿé€šï¼æˆ‘ä»¬ä¼šç¡®ä¿APIçš„ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ã€‚ 