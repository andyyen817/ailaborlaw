# AI劳法通聊天模块API测试页面使用指南

## 🎯 概述

本文档为前端开发团队提供聊天模块API测试页面的使用指导，帮助快速了解和测试所有聊天相关API接口。

## 📋 页面访问

**测试页面地址：** `http://localhost:3000/test-api.html`

**前置条件：**
1. 确保后端服务已启动 (`npm start` 在 `/backend` 目录)
2. 确保MongoDB数据库连接正常
3. 确保N8N服务可访问 (可选，用于AI功能测试)

## 🚀 快速开始

### 步骤 1: 用户认证
1. 访问测试页面
2. 点击"認證 API"标签
3. 使用快速登录选项：
   - **普通用户测试：** 点击"普通管理員(newadmin)"
   - **管理员测试：** 点击"超級管理員(admin)"
4. 登录成功后会自动保存Token

### 步骤 2: 聊天功能测试
1. 点击"聊天模組 API"标签
2. 建议按以下顺序测试：

#### 🔥 一键测试（推荐新手）
- 点击"🚀 快速测试工具"区域的"開始一鍵測試"
- 系统会自动执行：创建会话→发送消息→获取AI回复→查看详情
- 成功后会自动设置为当前会话

#### 📝 手动测试流程
1. **创建会话**
   - 在"會話管理"区域
   - 输入会话标题（可选）
   - 点击"創建會話"

2. **发送消息**
   - 在"消息處理"区域
   - 会话ID会自动填充（或手动输入）
   - 输入问题内容，如："请问加班费的计算方式？"
   - 点击"發送消息"

3. **查看AI回复**
   - 系统会显示AI回复内容
   - 包含法条引用、处理时间等信息
   - 自动填充反馈表单

## 📊 功能模块详解

### 1. 用户端API测试 (7个接口)

#### 会话管理
- **创建会话：** 创建新的聊天会话
- **会话列表：** 查看用户的所有会话（支持搜索和分页）
- **会话详情：** 查看特定会话的详细信息
- **更新标题：** 修改会话标题
- **删除会话：** 删除会话及其所有消息

#### 消息处理
- **发送消息：** 核心功能，发送用户问题并获取AI回复
- **消息历史：** 查看会话中的所有消息
- **用户反馈：** 对AI回复进行满意度反馈

### 2. 管理员API测试 (4个接口)

#### 监控功能
- **所有会话：** 查看系统中所有用户的会话
- **会话详情：** 管理员视角的会话详细信息

#### 数据分析
- **统计数据：** 获取聊天系统的统计信息
- **数据导出：** 导出聊天记录到Excel文件

### 3. 测试工具

#### 快速测试
- **一键测试：** 自动化完整测试流程
- **预设问题：** 常见劳基法问题快速测试
- **错误场景：** 异常情况测试

#### N8N服务测试
- **服务状态：** 检查AI服务运行状态
- **连接测试：** 测试与N8N服务的连接
- **直接测试：** 绕过业务逻辑直接测试AI服务

## 🎯 常见测试场景

### 场景 1: 完整用户流程测试
```
1. 登录 → 2. 创建会话 → 3. 发送问题 → 4. 查看AI回复 → 5. 提交反馈
```

### 场景 2: 管理员监控测试
```
1. 管理员登录 → 2. 查看所有会话 → 3. 查看统计数据 → 4. 导出数据
```

### 场景 3: 错误处理测试
```
1. 测试无效会话ID → 2. 测试空消息 → 3. 测试无认证访问
```

## 🚨 注意事项

### 认证相关
- 所有聊天API都需要JWT认证
- Token会自动保存在localStorage中
- 如果遇到401错误，请重新登录

### 会话管理
- 创建会话后会自动设置为"当前会话"
- 当前会话信息显示在页面顶部
- 相关表单会自动填充当前会话ID

### AI功能测试
- 发送消息可能需要5-10秒等待AI回复
- 如果N8N服务不可用，会返回降级回复
- AI回复包含法条引用和处理时间信息

### 管理员功能
- 需要管理员权限才能访问统计和导出功能
- 数据导出支持Excel和CSV格式
- 统计数据包含多个维度的分析

## 🔧 API接口参考

### 基础URL
```
http://localhost:3000/api/v1
```

### 用户端接口
```
POST   /chat/sessions                    # 创建会话
GET    /chat/sessions                    # 会话列表
GET    /chat/sessions/:sessionId         # 会话详情
PUT    /chat/sessions/:sessionId         # 更新标题
DELETE /chat/sessions/:sessionId         # 删除会话
POST   /chat/sessions/:sessionId/messages # 发送消息
GET    /chat/sessions/:sessionId/messages # 消息列表
```

### 管理员接口
```
GET    /admin/chat/sessions              # 所有会话
GET    /admin/chat/stats                 # 统计数据
POST   /admin/chat/export                # 导出记录
GET    /admin/chat/sessions/:sessionId/messages # 会话详情
```

## 📚 相关文档

- **详细API文档：** `backendF/AI劳法通聊天模块API文档.md`
- **错误码说明：** 详见API文档中的错误码部分
- **认证机制：** JWT Bearer Token认证

## 🆘 问题排查

### 常见问题
1. **无法登录：** 检查后端服务是否启动
2. **API调用失败：** 检查网络连接和Token有效性
3. **AI回复异常：** 检查N8N服务状态
4. **数据显示错误：** 清除浏览器缓存和localStorage

### 调试支持
- 所有API响应都会格式化显示
- 错误信息包含详细的错误码和描述
- 可以通过浏览器开发者工具查看网络请求
- 测试页面会显示完整的请求和响应信息

## 🎉 开始测试

现在您可以开始使用测试页面了！建议先从"一键测试"开始，熟悉整体流程后再进行详细的功能测试。

如有任何问题，请联系后端开发团队获取支持。 